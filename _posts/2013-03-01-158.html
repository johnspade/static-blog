---
layout: post
title: |-
  Расширение для поиска выделенного текста на Last.fm
date: 2013-03-01 01:02:00
tags: 
  - софт
  - музыка
  - проекты
  - javascript
  - программирование
---

Я люблю слушать музыку, а еще я страшный лентяй. Если вижу в интернетах упоминание какого-то музыкального исполнителя в положительном контексте, мне хочется с ним познакомиться. Для этого я открываю его страничку на Last.fm и смотрю, какие у него самые популярные по прослушиваниям песни. Мне кажется, именно с них лучше всего начинать знакомиться с исполнителем. Но копировать текст руками, открывать новую вкладку, вводить адрес last.fm, вставлять текст в строку поиска - это таааак лень... Я студент-айтишник, и культивировать свою лень с помощью компьютера - мое предназначение. Так что я написал несложное расширение, которое добавляет в контекстное меню Chrome пункт для поиска выделенного текста на last.fm одним кликом.<br /><br /><a name="more"></a><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Qc2T-_4Vscg/US-2DjhS9kI/AAAAAAAAFHw/ULGdQlCm1NI/s1600/lfmf.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://1.bp.blogspot.com/-Qc2T-_4Vscg/US-2DjhS9kI/AAAAAAAAFHw/ULGdQlCm1NI/s640/lfmf.png" width="414" /></a></div><br />Расскажу немного о создании. Это не мануал по созданию расширений, я просто покажу, как решил поставленную задачу. Как и гаджет Windows, расширение для Google Chrome требует манифест, только в формате JSON: <br /><pre>{<br /> "manifest_version": 2,<br /> "name": "Simple Last.Fm Finder",<br /> "version": "1.0",<br /> "icons": {<br />  "16": "icon16.png",<br />  "48": "icon48.png"<br /> },<br /> "description": "Расширение добавляет в контекстное меню пункт для быстрого поиска выделенного текста на last.fm.",<br /> "background": {<br />  "scripts": ["background.js"]<br /> },<br /> "permissions": [<br />  "http://*/*",<br />  "https://*/*",<br />  "contextMenus",<br />  "tabs"<br /> ]<br />}<br /></pre>Версию манифеста, равную 2, указывать обязательно - без этого расширение не станет работать. Иконка 16x16 будет отображаться рядом с моим пунктом меню, а 48x48 - представлять мой продукт на странице расширений. Я, не мудрствуя лукаво, взял соответствующие логотипы Last.fm. Обычно в манифесте указывают background и popup страницы, но мне они не нужны, у меня только один скрипт - Хром сам сгенерирует для него страницу.  Далее я запрашиваю разрешения на работу с контекстным меню и вкладками. Должен признаться, я не очень понял, на какие URL мне нужны разрешения, но расширение должно работать везде, так что оно получает доступ ко всем страницам.<br /><br />Больше от манифеста мне ничего не нужно. Теперь можно написать простенький скрипт: <br /><pre>chrome.contextMenus.create({<br /> "title": "Search on last.fm",<br /> "contexts": ["selection"],<br /> "onclick": search<br />});<br /><br />function search(e) {<br /> var lastFmSearchUrl = "http://www.lastfm.ru/search?q=";<br /> var searchQuery = e.selectionText;<br /> var searchUrl = lastFmSearchUrl + searchQuery;<br /> chrome.tabs.create({"url": searchUrl });<br />}<br /></pre>Он с помощью Chrome API при выделении текста создает пункт меню "Search on last.fm", по клику собирает поисковую ссылку с выделенным текстом и открывает новую вкладку с этим адресом. Код расширения написан, осталось только запаковать его на странице расширений в режиме разработчика.<br /><br />Мне нравится Chrome API - оно довольно удобное, в нем много нужных плюшек, но в документации слишком скудные примеры, как по мне. Еще очень понравилась отладка расширений. Чтобы запустить гаджет Windows, его надо запаковать в архив, сменить расширение на .gadget и запустить, после внесения изменений эту процедуру надо произвести еще раз. В Хроме надо всего лишь указать папку с проектом и после внесения изменений нажать "Обновить расширение". Лентяй во мне доволен.<br /><br />Как всегда, в комментариях приветствуются конструктивные замечания, особенно об ошибках. Если вам нужно, вы можете скачать мое расширение. Для установки перетащите файл на страницу с расширениями.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://dl.dropbox.com/u/11765297/Simple%20last.fm%20finder.crx" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-EV7JoXhWrio/TQ3HDPLexMI/AAAAAAAAC0k/tercWQVGBaE/s1600/Download.png" /></a></div>